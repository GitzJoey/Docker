#!/bin/bash

# Script to update docker-compose services (pull or rebuild depending on configuration)

set -e

COMPOSE_FILE="docker-compose.yml"
COMPOSE_CMD="docker compose"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "ğŸ” Checking docker-compose file: $COMPOSE_FILE"

if grep -q "build:" "$COMPOSE_FILE"; then
  echo "ğŸ”§ Build directive found â€” rebuilding services..."
  $COMPOSE_CMD build --no-cache
else
  echo "â¬‡ï¸ Pulling latest images..."
  $COMPOSE_CMD pull
fi

echo "ğŸ”„ Restarting services..."
$COMPOSE_CMD up -d

echo "âœ… Update complete."
